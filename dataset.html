<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generator Dataset Sewa (360 baris)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; }
    body { margin: 0; background: #0b1020; color: #e7ecf4; }
    .wrap { max-width: 1100px; margin: auto; padding: 24px; }
    h1 { margin: 0 0 6px; font-size: 28px; }
    p { margin: 0 0 18px; color: #b8c2d6; }
    .panel { background: #121936; border: 1px solid #263362; border-radius: 16px; padding: 16px; display: grid; gap: 12px; }
    .row { display: grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap: 10px; align-items: end; }
    .row > * { min-width: 0; }
    label { font-size: 12px; color: #9fb0ce; display: block; margin-bottom: 6px; }
    input, select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #2d3b6b; background: #0e1530; color: #e7ecf4; }
    button { padding: 10px 14px; border: 1px solid #3a57a5; background: #1a2a6a; color: #fff; border-radius: 12px; cursor: pointer; transition: transform .05s ease; }
    button:hover { transform: translateY(-1px); }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    .grid { overflow: auto; border-radius: 14px; border: 1px solid #243261; }
    table { border-collapse: collapse; width: 100%; min-width: 900px; }
    th, td { padding: 8px 10px; border-bottom: 1px dashed #22305f; font-size: 13px; white-space: nowrap; }
    th { position: sticky; top: 0; background: #0f1734; text-align: left; }
    .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; border: 1px solid #2b3b74; background: #0f1734; font-size: 11px; }
    .muted { color: #9fb0ce; font-size: 12px; }
    .ok { color: #7ce38b; }
    .warn { color: #ffd479; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Generator Dataset Sewa</h1>
    <p>Dataset sintetis untuk tiga kategori utama: <strong>Barang</strong> (elektronik, alat catering, alat camping), <strong>Kendaraan</strong> (truk, mobil, motor), dan <strong>Properti</strong> (ruang rapat, ruko). Default: 120 data per kategori (total 360 baris). Lokasi diprioritaskan Bandung & Jakarta.</p>

    <div class="panel">
      <div class="row">
        <div>
          <label>Jumlah Barang</label>
          <input id="nBarang" type="number" value="120" min="1" />
        </div>
        <div>
          <label>Jumlah Kendaraan</label>
          <input id="nKendaraan" type="number" value="120" min="1" />
        </div>
        <div>
          <label>Jumlah Properti</label>
          <input id="nProperti" type="number" value="120" min="1" />
        </div>
        <div>
          <label>Seed (opsional)</label>
          <input id="seed" type="number" placeholder="acak" />
        </div>
        <div>
          <label>Format Harga</label>
          <select id="currency">
            <option value="IDR" selected>IDR (Rp)</option>
            <option value="USD">USD ($)</option>
          </select>
        </div>
        <div>
          <label>&nbsp;</label>
          <div class="btns">
            <button id="btnGen">Generate</button>
            <button id="btnCsv" disabled>Download CSV</button>
          </div>
        </div>
      </div>
      <div class="muted">Kolom: id, category, subcategory, name, city, district, condition, daily_price, weekly_price, monthly_price, deposit, unit, min_days, max_days, vendor, rating, availability, latitude, longitude.</div>
      <div class="muted">Catatan: Data ini <span class="warn">bukan hasil scraping</span>; ini <span class="ok">dataset sintetis realistis</span> untuk keperluan pengembangan & pengujian.</div>
    </div>

    <p style="margin-top:14px;" class="muted"><span class="badge">Status: <span id="status">Belum ada data</span></span></p>

    <div class="grid" style="margin-top:12px;">
      <table id="tbl">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // ===== Util Random (dengan optional seed) =====
    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
    const rng = { fn: Math.random };
    function setSeed(s){ rng.fn = Number.isFinite(s)? mulberry32(Math.floor(s)) : Math.random }
    function rand(){ return rng.fn() }
    function choice(arr){ return arr[Math.floor(rand()*arr.length)] }
    function randint(min,max){ return Math.floor(rand()*(max-min+1))+min }
    function randf(min,max){ return rand()*(max-min)+min }

    // ===== Referensi Lokasi (Bandung & Jakarta diprioritaskan) =====
    const cities = [
      {city:"Bandung", lat:-6.914744, lon:107.60981, districts:["Coblong","Lengkong","Cicendo","Antapani","Sukajadi","Ujungberung","Arcamanik","Kiaracondong","Sumur Bandung"]},
      {city:"Jakarta", lat:-6.208763, lon:106.8456, districts:["Menteng","Cilandak","Kebayoran Baru","Tebet","Kuningan","Gambir","Tanjung Priok","Grogol Petamburan","Cempaka Putih"]},
      {city:"Bekasi", lat:-6.23827, lon:106.9756, districts:["Bekasi Selatan","Bekasi Barat","Bekasi Timur","Medan Satria"]},
      {city:"Depok", lat:-6.402484, lon:106.7942, districts:["Beji","Sukmajaya","Cimanggis","Pancoran Mas"]},
      {city:"Bogor", lat:-6.597147, lon:106.8060, districts:["Bogor Tengah","Bogor Timur","Bogor Barat","Tanah Sareal"]},
      {city:"Cimahi", lat:-6.8722, lon:107.5429, districts:["Cimahi Utara","Cimahi Tengah","Cimahi Selatan"]}
    ];
    function weightedCity(){
      // 55% Bandung, 25% Jakarta, 20% lainnya
      const r = rand();
      if (r < 0.55) return cities[0];
      if (r < 0.80) return cities[1];
      return choice(cities.slice(2));
    }

    // ===== Referensi Nama & Rentang Harga =====
    const barang = {
      elektronik: [
        {name:"Kamera DSLR Canon EOS 200D", unit:"unit", daily:[70000,140000]},
        {name:"Kamera Mirrorless Sony A6000", unit:"unit", daily:[90000,180000]},
        {name:"Laptop i5 8GB RAM", unit:"unit", daily:[120000,220000]},
        {name:"Projector 3300 ANSI", unit:"unit", daily:[80000,160000]},
        {name:"Mic Wireless Dual", unit:"set", daily:[60000,120000]},
        {name:"Speaker Portable 12\"", unit:"unit", daily:[50000,100000]},
        {name:"LED TV 43 inci", unit:"unit", daily:[120000,220000]},
        {name:"Action Cam 4K", unit:"unit", daily:[60000,120000]}
      ],
      catering: [
        {name:"Chafing Dish Stainless", unit:"set", daily:[15000,30000]},
        {name:"Meja Prasmanan 2m", unit:"unit", daily:[30000,60000]},
        {name:"Kursi Futura", unit:"unit", daily:[5000,12000]},
        {name:"Tenda Dekorasi 3x6m", unit:"unit", daily:[80000,150000]},
        {name:"Dispenser Minuman 8L", unit:"unit", daily:[10000,20000]},
        {name:"Rice Cooker 10L", unit:"unit", daily:[15000,30000]}
      ],
      camping: [
        {name:"Tenda Dome 4 orang", unit:"unit", daily:[25000,60000]},
        {name:"Sleeping Bag 10Â°C", unit:"unit", daily:[10000,20000]},
        {name:"Kompor Portable + Gas", unit:"set", daily:[15000,30000]},
        {name:"Matras Lipat", unit:"unit", daily:[8000,15000]},
        {name:"Lampu Camping Rechargeable", unit:"unit", daily:[10000,20000]},
        {name:"Carrier 60L", unit:"unit", daily:[15000,30000]}
      ]
    };

    const kendaraan = {
      mobil: [
        {name:"Toyota Avanza 1.3", unit:"unit", daily:[300000,450000]},
        {name:"Daihatsu Xenia 1.3", unit:"unit", daily:[280000,420000]},
        {name:"Honda Brio 1.2", unit:"unit", daily:[250000,400000]},
        {name:"Suzuki Ertiga", unit:"unit", daily:[300000,480000]},
        {name:"Xpander 1.5", unit:"unit", daily:[350000,550000]}
      ],
      motor: [
        {name:"Honda Beat 110", unit:"unit", daily:[60000,90000]},
        {name:"Yamaha NMAX 155", unit:"unit", daily:[90000,140000]},
        {name:"Vario 125", unit:"unit", daily:[80000,120000]},
        {name:"Scoopy 110", unit:"unit", daily:[70000,100000]}
      ],
      truk: [
        {name:"Truk Engkel Box", unit:"unit", daily:[650000,900000]},
        {name:"Truk CDD (Double)", unit:"unit", daily:[900000,1400000]},
        {name:"Pickup L300", unit:"unit", daily:[400000,650000]}
      ]
    };

    const properti = {
      ruang_rapat: [
        {name:"Ruang Rapat 8 pax", unit:"slot/hari", daily:[300000,700000]},
        {name:"Ruang Rapat 12 pax", unit:"slot/hari", daily:[500000,1200000]},
        {name:"Ruang Presentasi 20 pax", unit:"slot/hari", daily:[900000,1800000]}
      ],
      ruko: [
        {name:"Ruko 2 Lantai 4x12m", unit:"unit", daily:[800000,1500000]},
        {name:"Ruko Hook 2 Lantai 5x15m", unit:"unit", daily:[1200000,2500000]},
        {name:"Kios 3x4m", unit:"unit", daily:[300000,700000]}
      ]
    };

    const conditions = ["baru","bagus","normal","layak pakai"];

    // ===== Helper harga & format =====
    function roundTo(v, step){ return Math.round(v/step)*step }
    function idr(n){ return new Intl.NumberFormat('id-ID', { style:'currency', currency:'IDR', maximumFractionDigits:0 }).format(n) }
    function usd(n){ return new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits:0 }).format(n/15500) }

    function priceFormat(curr, n){ return curr==='USD'? usd(n): idr(n) }

    function computePrices(base){
      // daily base, weekly ~ 6x daily, monthly ~ 20x daily, deposit 1.5-3x daily
      const daily = roundTo(randf(base[0], base[1]), 5000);
      const weekly = roundTo(daily * randf(5.5, 6.8), 5000);
      const monthly = roundTo(daily * randf(18, 22), 5000);
      const deposit = roundTo(daily * randf(1.5, 3.0), 5000);
      return { daily, weekly, monthly, deposit };
    }

    // ===== Generator record =====
    function makeRecord({category, subcategory, ref, counter}){
      const loc = weightedCity();
      const district = choice(loc.districts);
      const cond = choice(conditions);
      const pr = computePrices(ref.daily);
      const minDays = randint(1,3);
      const maxDays = randint(7,30);
      const vendor = `${choice(["CV","UD","PT","Studio","Rental","Sewa"])} ${choice(["Bandung","Jakarta","Nusantara","Jaya","Maju","Utama"])}`;
      const rating = Math.round(randf(3.8, 5.0)*10)/10;
      const available = rand() > 0.08 ? "available" : "booked";
      // sedikit jitter lokasi (~1-3 km)
      const lat = +(loc.lat + randf(-0.02, 0.02)).toFixed(6);
      const lon = +(loc.lon + randf(-0.02, 0.02)).toFixed(6);
      return {
        id: `${category.substring(0,1)}-${subcategory.substring(0,3)}-${counter}`,
        category,
        subcategory,
        name: ref.name,
        city: loc.city,
        district,
        condition: cond,
        daily_price: pr.daily,
        weekly_price: pr.weekly,
        monthly_price: pr.monthly,
        deposit: pr.deposit,
        unit: ref.unit,
        min_days: minDays,
        max_days: maxDays,
        vendor,
        rating,
        availability: available,
        latitude: lat,
        longitude: lon
      };
    }

    // ===== Generate per kategori =====
    function generateCategory(catLabel, groups, n){
      const out=[]; let i=1;
      const flat=[]; Object.entries(groups).forEach(([sub, arr])=> arr.forEach(x=> flat.push([sub,x])));
      while(out.length < n){
        const [sub, ref] = choice(flat);
        out.push( makeRecord({ category: catLabel, subcategory: sub, ref, counter: i++ }) );
      }
      return out;
    }

    // ===== CSV =====
    const headers = ["id","category","subcategory","name","city","district","condition","daily_price","weekly_price","monthly_price","deposit","unit","min_days","max_days","vendor","rating","availability","latitude","longitude"];
    function toCSV(rows, currency){
      const encodeCell = (v)=>{
        if (typeof v === 'string'){
          const s = v.replaceAll('"','""');
          return `"${s}"`;
        }
        return String(v);
      };
      // copy & format price columns when previewing only; for CSV keep numeric raw
      const lines=[ headers.join(',') ];
      for (const r of rows){
        const row = headers.map(h=> r[h]);
        lines.push( row.map(encodeCell).join(',') );
      }
      return lines.join('\n');
    }

    function download(filename, text){
      const blob = new Blob([text], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.style.display='none';
      document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 200);
    }

    // ===== Render Table =====
    function renderTable(rows, currency){
      const thead = document.querySelector('#tbl thead');
      const tbody = document.querySelector('#tbl tbody');
      thead.innerHTML = '<tr>' + headers.map(h=>`<th>${h}</th>`).join('') + '</tr>';
      const fmt = (h, v)=>{
        if (["daily_price","weekly_price","monthly_price","deposit"].includes(h)) return priceFormat(currency, v);
        return v;
      };
      const frag = document.createDocumentFragment();
      rows.slice(0,300).forEach(r=>{ // render maksimal 300 baris untuk performa
        const tr = document.createElement('tr');
        headers.forEach(h=>{
          const td = document.createElement('td');
          td.textContent = fmt(h, r[h]);
          tr.appendChild(td);
        });
        frag.appendChild(tr);
      });
      tbody.innerHTML='';
      tbody.appendChild(frag);
    }

    // ===== Main =====
    let currentRows = [];
    function generateAll(){
      const nB = +document.getElementById('nBarang').value || 120;
      const nK = +document.getElementById('nKendaraan').value || 120;
      const nP = +document.getElementById('nProperti').value || 120;
      const seedVal = document.getElementById('seed').value;
      setSeed(seedVal === '' ? undefined : Number(seedVal));

      const rows = [];
      rows.push(...generateCategory('Barang', barang, nB));
      rows.push(...generateCategory('Kendaraan', kendaraan, nK));
      rows.push(...generateCategory('Properti', properti, nP));

      currentRows = rows;
      const curr = document.getElementById('currency').value;
      renderTable(rows, curr);
      document.getElementById('status').textContent = `${rows.length} baris siap`;
      document.getElementById('btnCsv').disabled = false;
    }

    document.getElementById('btnGen').addEventListener('click', generateAll);
    document.getElementById('btnCsv').addEventListener('click', ()=>{
      const csv = toCSV(currentRows, document.getElementById('currency').value);
      download(`dataset-sewa-${currentRows.length}.csv`, csv);
    });

    // Auto-generate saat halaman dibuka untuk kenyamanan
    generateAll();
  </script>
</body>
</html>
